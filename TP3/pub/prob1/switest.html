<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>SWI Prolog HTTP Server Test</title>
	</head>
	<body>
		<h1>SWI HTTP Test</h1>
		
		<div id="content">
			<div id="params">
				
				<button type="button" id="search1" onClick="makeRequest();" >Send Good Move</button>
				<button type="button" id="search4" onClick="makeAleRequest();">Send Ale Move</button>
			</div>
			<div id="reply"></div>
		</div>
		<div id="content1">
			<div id="params1">
				Poss Plays:<input type="text" id="possPlays" value="[]" size="100"/>
				<br/>
				<button type="button" id="search7" onClick="makeRequest00();" >Play [0,0]</button>
				<button type="button" id="search8" onClick="makeRequest01();">Play [0,1]</button>
				<button type="button" id="search9" onClick="makeRequest02();">Play [0,2]</button>
			</div>
			<div id="reply2"></div>
		</div>
		<div id="parameters">
			<div id="params1">
				
				Board:<input type="text" id="board" value="[[1,1,1,1,1],[0,0,0,0,0],[0,0,3,0,0],[0,0,0,0,0],[2,2,2,2,2]]" size="45"/>
				<br/>
				Curr Player:<input type="text" id="currPlayer" value="1"/>
				<br/>
				Next Play:<input type="text" id="play" value="Next play: soldier"/>
				<br/>
				NX: <input type="text" id="nx" value="2"/>
				<br/>
				NY: <input type="text" id="ny" value="2"/>
				<br/>
				<button type="button" id="randomPlay" onClick="makeRequestIntMove();" >Random Inteligent Play</button>
				<button type="button" id="randomNeutronPlay" onClick="makeIntAleRequest();">Send Neutron Random Move</button>
			</div>
			<div id="otherReply"></div>
		</div>
		
		<script type="text/javascript">
			function postGameRequest(requestString, onSuccess, onError)
			{
				var request = new XMLHttpRequest();
				request.open('POST', '../../game', true);

				request.onload = onSuccess || function(data){console.log("Request successful. Reply: " + data.target.response);};
				request.onerror = onError || function(){console.log("Error waiting for response");};

				request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');
				request.send('requestString='+encodeURIComponent(requestString));			
			}
		
			function makeRequest()
			{
				// Get Parameter Values
				var v_board = document.querySelector("#board").value;
				var v_player = document.querySelector("#currPlayer").value;
				//var v_play = document.querySelector("#play").value;
				
				// Compose Request String
				var requestString = "[jogada," + v_board + ", 0, 0, 3, 0, " + v_player + "]";
				postGameRequest(requestString,handleReply);
				
			}

			function makeAleRequest()
			{
				// Get Parameter Values
				var v_board = document.querySelector("#board").value;
				var v_player = document.querySelector("#currPlayer").value;
				// Compose Request String
				
				var requestString = "[jogada_ale," + v_board + ", "+ v_player + "]";
				postGameRequest(requestString,handleReply);
				
			}
			function makeIntAleRequest()
			{
				// Get Parameter Values
				var v_board = document.querySelector("#board").value;
				var v_player = document.querySelector("#currPlayer").value;
				var nx = document.querySelector("#nx").value;
				var ny = document.querySelector("#ny").value;

				var requestString = "[jogada_ale_neutron," + v_board + ", " + nx + ", " + ny + ", " + v_player + "]";

				console.log(requestString);
				postGameRequest(requestString,handleMyReply);
				
			}
			function makeRequestIntMove()
			{
				// Get Parameter Values
				var v_board = document.querySelector("#board").value;
				var v_player = document.querySelector("#currPlayer").value;
				var next_play = document.querySelector("#play").value;
				var nx = document.querySelector("#nx").value;
				var ny = document.querySelector("#ny").value;

				if(next_play == "Next play: neutron"){
					var requestString = "[jogada_int," + v_board + ", " + nx + ", " + ny + ", " + v_player + "]";

					console.log(requestString);
					postGameRequest(requestString,handleMyReply);
				}
				else if (next_play == "Next play: soldier"){
					var requestString = "[jogada_ale," + v_board + ", " + v_player + "]";

					console.log(requestString);
					postGameRequest(requestString,handleMyReply);
				}
				// Compose Request String
				
			}
			function handleMyReply(data){
				response=JSON.parse(data.target.response);
				console.log(response);

				document.querySelector("#otherReply").innerHTML=response.message;

				document.querySelector("#board").value=response.newBoard;	
				
				document.querySelector("#currPlayer").value=response.newPlayer;

				if(response.newPlay == "1"){
					document.querySelector("#play").value="Next play: neutron";
				}
				else if (response.newPlay == "2"){
					document.querySelector("#play").value="Next play: soldier";
				}
				else if (response.newPlay == "3"){
					document.querySelector("#play").value="Winner is player above!";
				}

				if(response.nx != "-1"){
					document.querySelector("#nx").value=response.nx;
				}
				if(response.ny != "-1"){
					document.querySelector("#ny").value=response.ny;
				}

			}			
			
			function makeRequest00()
			{
				// Get Parameter Values
				var v_board = document.querySelector("#board").value;
				var v_player = document.querySelector("#currPlayer").value;
				// Compose Request String
				var requestString = "[jog_poss," + v_board + ", 0, 0, " + v_player + "]";
				postGameRequest(requestString,handlePlays);
				
			}

			function makeRequest01()
			{
				// Get Parameter Values
				var v_board = document.querySelector("#board").value;
				var v_player = document.querySelector("#currPlayer").value;
				// Compose Request String
				var requestString = "[jog_poss," + v_board + ", 0, 1, " + v_player + "]";
				postGameRequest(requestString,handlePlays);
				
			}

			function makeRequest02()
			{
				// Get Parameter Values
				var v_board = document.querySelector("#board").value;
				var v_player = document.querySelector("#currPlayer").value;
				// Compose Request String
				var requestString = "[jog_poss," + v_board + ", 0, 2, " + v_player + "]";
				postGameRequest(requestString,handlePlays);
				
			}
			
			//Handle the JSON Reply
			
			function handleReply(data){
				response=JSON.parse(data.target.response);
				console.log(response);

				document.querySelector("#reply").innerHTML=response.message;		// Access message and show
				document.querySelector("#currPlayer").value=response.newPlayer;

				if(response.newPlay == "0"){
					document.querySelector("#play").value="neutron";
				}
				else if(response.newPlay == "1"){
					document.querySelector("#play").value="soldier";
				}

				if(response.newBoard != "-1"){
					document.querySelector("#board").value=response.newBoard;
				}
							// Access new Board
				console.log(response.newPlayer);
				
			}
			
			function handlePlays(data){
				response=JSON.parse(data.target.response);
				console.log(response);
				document.querySelector("#reply2").innerHTML=response.message;		// Access message and show
				
				document.querySelector("#possPlays").value=response.newBoard;
						// Access new Board
			}

			
		</script>
		
	</body>
</html>